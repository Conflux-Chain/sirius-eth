FROM node:20 AS builder

WORKDIR /app
COPY ./package.json .
COPY ./yarn.lock .
RUN yarn install --frozen-lockfile



ARG NETWORK_ID=1030
ARG NETWORK_NAME=Conflux eSpace
ARG NETWORK_TYPE=EVM_MAINNET
ARG SCAN_BACKEND_API=https://evm.confluxscan.io
ARG OPEN_API_HOST=https://evm.confluxscan.io
ARG RPC_SERVER=https://evm-cfxbridge.confluxrpc.com
ARG OPEN_CORE_API=https://api.confluxscan.io
ARG SCAN_CORE_SCAN_API=https://www.confluxscan.io
ARG LOGO=

ARG WALLET_CONFIG_RPC_URL=https://evm.confluxrpc.com
ARG WALLET_CONFIG_BLOCK_EXPLORER_URL=https://evm.confluxscan.io
ARG WALLET_CONFIG_NATIVE_CURRENCY_NAME=CFX
ARG WALLET_CONFIG_NATIVE_CURRENCY_SYMBOL=CFX
ARG WALLET_CONFIG_NATIVE_CURRENCY_DECIMALS=18
ARG ADDRESS_TYPE=hex


ENV REACT_APP_NETWORK_ID=${NETWORK_ID}
ENV REACT_APP_NETWORK_NAME=${NETWORK_NAME}
ENV REACT_APP_NETWORK_TYPE=${NETWORK_TYPE}
ENV REACT_APP_SCAN_BACKEND_API=${SCAN_BACKEND_API}
ENV REACT_APP_OPEN_API_HOST=${OPEN_API_HOST}
ENV REACT_APP_RPC_SERVER=${RPC_SERVER}
ENV REACT_APP_OPEN_CORE_API=${OPEN_CORE_API}
ENV REACT_APP_SCAN_CORE_SCAN_API=${SCAN_CORE_SCAN_API}
ENV REACT_APP_LOGO=${LOGO}

ENV REACT_APP_WALLET_CONFIG_RPC_URL=${WALLET_CONFIG_RPC_URL}
ENV REACT_APP_WALLET_CONFIG_BLOCK_EXPLORER_URL=${WALLET_CONFIG_BLOCK_EXPLORER_URL}
ENV REACT_APP_WALLET_CONFIG_NATIVE_CURRENCY_NAME=${WALLET_CONFIG_NATIVE_CURRENCY_NAME}
ENV REACT_APP_WALLET_CONFIG_NATIVE_CURRENCY_SYMBOL=${WALLET_CONFIG_NATIVE_CURRENCY_SYMBOL}
ENV REACT_APP_WALLET_CONFIG_NATIVE_CURRENCY_DECIMALS=${WALLET_CONFIG_NATIVE_CURRENCY_DECIMALS}
ENV REACT_APP_ADDRESS_TYPE=${ADDRESS_TYPE}



COPY . .

RUN node ./docker/setupEnv.mjs

RUN yarn build

FROM nginx:1-alpine

COPY --from=builder /app/docker/nginx.conf /etc/nginx/nginx.conf

COPY --from=builder /app/build /var/www/sirius-eth/build
